<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Atualizar Usuário</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>

    <h2>Alterar Dados do Usuário</h2>

    <form id="formAtualizarUsuario">
        <input type="hidden" id="usuarioId" value=""> <!-- Campo de ID oculto -->

        <div>
            <label for="nome">Nome:</label>
            <input type="text" id="nome" name="nome" required>
        </div>

        <div>
            <label for="email">Email:</label>
            <input type="email" id="email" name="email" required>
        </div>

        <div>
            <label for="senha">Senha:</label>
            <input type="password" id="senha" name="senha" required>
        </div>

        <div>
            <label for="telefone">Telefone:</label>
            <input type="text" id="telefone" name="telefone" required>
        </div>

        <div>
            <label for="cep">CEP:</label>
            <input type="text" id="cep" name="cep" required>
        </div>

        <div>
            <label for="logradouro">Logradouro:</label>
            <input type="text" id="logradouro" name="logradouro" required>
        </div>

        <div>
            <label for="numero">Número:</label>
            <input type="text" id="numero" name="numero" required>
        </div>

        <div>
            <label for="bairro">Bairro:</label>
            <input type="text" id="bairro" name="bairro" required>
        </div>

        <div>
            <label for="complemento">Complemento:</label>
            <input type="text" id="complemento" name="complemento">
        </div>

        <div>
            <label for="cidade">Cidade:</label>
            <input type="text" id="cidade" name="cidade" required>
        </div>

        <div>
            <label for="estado">Estado:</label>
            <input type="text" id="estado" name="estado" required>
        </div>

        <div>
            <button type="submit">Atualizar</button>
        </div>
    </form>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const usuarioId = urlParams.get('id'); // Obtém o ID da URL
        carregarDadosUsuario(usuarioId); // Carrega os dados do usuário

        function carregarDadosUsuario(id) {
        fetch(`http://localhost:8080/usuario/${id}`)
        .then(response => response.json())
        .then(data => {
            // Verifica se os dados do usuário foram carregados corretamente
            if (data) {
                document.getElementById("usuarioId").value = data.id;
                document.getElementById("nome").value = data.nome;
                document.getElementById("email").value = data.email;
                document.getElementById("senha").value = data.senha;
                document.getElementById("telefone").value = data.telefone;
                document.getElementById("cep").value = data.cep;
                document.getElementById("logradouro").value = data.logradouro;
                document.getElementById("numero").value = data.numero;
                document.getElementById("bairro").value = data.bairro;
                document.getElementById("complemento").value = data.complemento;
                document.getElementById("cidade").value = data.cidade;
                document.getElementById("estado").value = data.estado;
            } else {
                alert('Não foi possível carregar os dados do usuário.');
            }
        })
        .catch(error => {
            console.error('Erro ao carregar os dados do usuário:', error);
            alert('Erro ao carregar os dados do usuário.');
        });
}


        document.getElementById('formAtualizarUsuario').addEventListener('submit', function(event) {
            event.preventDefault();

            const dadosUsuario = {
                id: document.getElementById('usuarioId').value,
                nome: document.getElementById('nome').value,
                email: document.getElementById('email').value,
                senha: document.getElementById('senha').value,
                telefone: document.getElementById('telefone').value,
                cep: document.getElementById('cep').value,
                logradouro: document.getElementById('logradouro').value,
                numero: document.getElementById('numero').value,
                bairro: document.getElementById('bairro').value,
                complemento: document.getElementById('complemento').value,
                cidade: document.getElementById('cidade').value,
                estado: document.getElementById('estado').value
            };

            fetch(`http://localhost:8080/usuario/${usuarioId}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(dadosUsuario)
            })
            .then(response => response.json())
            .then(data => {
                alert('Dados atualizados com sucesso!');
            })
            .catch(error => {
                alert('Erro ao atualizar dados');
                console.error('Erro na atualização:', error);
            });
        });
    </script>

</body>
</html>
